{% extends "base.html" %}

{% block content %}
<div class="timeline">
    <div class="post">
        <div class="post-header">
            <div class="poster-info">
                <a href="/users/{{ owner }}/">
                    <img class="profile-picture" src="{{ owner_img_url }}" alt="profile picture">
                </a>
                <a href="/users/{{ owner }}/" class="username">{{ owner }}</a>
            </div>
            <a href="/posts/{{ postid }}/" class="timestamp">{{ timestamp }}</a>
        </div>

        <!-- Post image -->
        <div class="post-image">
            <img src="{{ img_url }}" alt="post image">
        </div>

        <!-- Like count -->
        <div class="post-interactions">
            {{ likes }} like{% if likes != 1 %}s{% endif %}
        </div>

        <!-- Like/Unlike button -->
        <div class="interaction-buttons">
            {% if liked_by_logname %}
            <form action="/likes/?target=/posts/{{ postid }}" method="post" enctype="multipart/form-data" class="like-form">
                <input type="hidden" name="operation" value="unlike"/>
                <input type="hidden" name="postid" value="{{ postid }}"/>
                <input type="submit" name="unlike" value="unlike" class="button unlike-btn"/>
            </form>
            {% else %}
            <form action="/likes/?target=/posts/{{ postid }}" method="post" enctype="multipart/form-data" class="like-form">
                <input type="hidden" name="operation" value="like"/>
                <input type="hidden" name="postid" value="{{ postid }}"/>
                <input type="submit" name="like" value="like" class="button like-btn"/>
            </form>
            {% endif %}
        </div>

        <!-- Comment form -->
        <form action="/comments/?target=/posts/{{ postid }}" method="post" enctype="multipart/form-data" class="comment-form">
            <input type="hidden" name="operation" value="create"/>
            <input type="hidden" name="postid" value="{{ postid }}"/>
            <input type="text" name="text" placeholder="Add a comment..." class="comment-input" required/>
            <input type="submit" name="comment" value="comment" class="button comment-btn"/>
        </form>

        <!-- Comment section -->
        <div class="comment-section">
            {% for comment in comments %}
            <div class="comment">
                <a href="/users/{{ comment.owner }}/" class="username">{{ comment.owner }}</a> {{ comment.text }}
                
                <!-- Delete comment button if the logged-in user owns the comment -->
                {% if comment.is_owner %}
                <form action="/comments/?target=/posts/{{ postid }}" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="operation" value="delete"/>
                    <input type="hidden" name="commentid" value="{{ comment.commentid }}"/>
                    <input type="submit" name="uncomment" value="delete" class="button delete-btn"/>
                </form>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- Delete post button if the logged-in user owns the post -->
        {% if is_owner %}
        <form action="/posts/?target=/users/{{ logname }}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="operation" value="delete"/>
            <input type="hidden" name="postid" value="{{ postid }}"/>
            <input type="submit" name="delete" value="delete this post" class="button delete-btn"/>
        </form>
        {% endif %}
    </div>
</div> <!-- Closing div for the timeline content -->
{% endblock %}
